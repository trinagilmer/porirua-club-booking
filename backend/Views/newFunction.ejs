<!DOCTYPE html>
<html>
<head>
  <html><link rel="stylesheet" href="/css/main.css">
  <title>New Function</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 20px; padding: 10px 20px; background: #0077cc; color: white; border: none; border-radius: 5px; }
    button:hover { background: #005fa3; cursor: pointer; }
    #tab_amount_field { display: none; }
  </style>
</head>
<body>
  <h1>Create New Function</h1>

  <form method="POST" action="/api/functions">
<!-- Booking (dropdown) -->
<label for="booking_id">Booking Contact:</label>
<select name="booking_id" id="booking_id" required>
  <option value="">-- Select Booking --</option>
  <% bookings.forEach(b => { %>
    <option value="<%= b.id %>">
      <%= b.name %> (<%= b.phone || "no phone" %>)
    </option>
  <% }) %>
</select>


    <!-- Event Name -->
    <label for="event_name">Event Name:</label>
    <input type="text" name="event_name" id="event_name" required>

    <!-- Room -->
    <label for="room">Room:</label>
    <input type="text" name="room" id="room">

    <!-- Attendees -->
    <label for="attendees">Number of Attendees:</label>
    <input type="number" name="attendees" id="attendees">

    <!-- Catering -->
    <label for="catering">Catering:</label>
    <input type="checkbox" name="catering" id="catering">

    <!-- Legacy Bar Service -->
    <label for="bar_service">Bar Service (legacy yes/no):</label>
    <input type="checkbox" name="bar_service" id="bar_service">

    <!-- New Bar Service Dropdown -->
    <label for="bar_type">Bar Type:</label>
    <select name="bar_type" id="bar_type" onchange="toggleTabAmount()">
      <option value="">-- Select --</option>
      <option value="cash">Cash Bar</option>
      <option value="hosted">Hosted Bar</option>
      <option value="tab">Bar Tab</option>
    </select>

    <!-- Tab Amount (only shows if "tab" is selected) -->
    <div id="tab_amount_field">
      <label for="bar_tab_amount">Bar Tab Amount:</label>
      <input type="number" name="bar_tab_amount" id="bar_tab_amount" step="0.01">
    </div>

    <!-- Bar Notes -->
    <label for="bar_notes">Bar Notes:</label>
    <textarea name="bar_notes" id="bar_notes" rows="3"></textarea>
    <!-- Services -->
<h2>Services</h2>
<div id="services">
  <div class="service">
    <label>Service Name:</label>
    <input type="text" name="services[0][service_name]" placeholder="e.g. Buffet Dinner">

    <label>Quantity:</label>
    <input type="number" name="services[0][qty]" min="1">

    <label>Price:</label>
    <input type="number" step="0.01" name="services[0][price]">

    <label>Notes:</label>
    <input type="text" name="services[0][notes]">
  </div>
</div>


    <!-- General Notes -->
    <label for="notes">General Notes:</label>
    <textarea name="notes" id="notes" rows="3"></textarea>

    <button type="submit">Create Function</button>
  </form>

  <script>
    function toggleTabAmount() {
      const barType = document.getElementById("bar_type").value;
      const tabField = document.getElementById("tab_amount_field");
      tabField.style.display = barType === "tab" ? "block" : "none";
    }
  </script>
</body>
</html>
