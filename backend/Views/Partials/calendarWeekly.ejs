<div class="weekly-cal calendar">
  <div style="display:flex;justify-content:space-between;align-items:center;margin:8px 0;">
    <div><strong>Week:</strong> <%= start %> → <%= end %></div>
    <div>
      <a href="/staff/calendar/weekly?start=<%= shift(start, -7) %>">◀ Prev</a>
      <a href="/staff/calendar/weekly?start=<%= shift(start,  7) %>" style="margin-left:8px;">Next ▶</a>
    </div>
  </div>

  <table class="pc-table">
    <thead>
      <tr>
        <% (days || []).forEach(d => { %>
          <th><%= d.dateStr %></th>
        <% }) %>
      </tr>
    </thead>
    <tbody>
      <tr>
        <% (days || []).forEach(d => { 
             const list = (events && events[d.dateKey]) || []; %>
          <td class="<%= d.isToday ? 'today' : (d.isPast ? 'past' : '') %>">
            <% if (!list.length) { %>
              <div class="muted">No events</div>
            <% } else { %>
              <ul style="margin:0;padding-left:16px;">
                <% list.forEach(ev => { %>
                  <% if (ev.evtype === 'booking') { %>
                    <!-- Booking -->
                    <li class="ev bk">
                      <span class="i bk">Booking</span>
                      <a href="/bookings/<%= ev.id %>" class="muted">
                        <strong><%= ev.name %></strong>
                      </a>
                      <% if (ev.type) { %> · <%= ev.type %><% } %>
                      <% if (ev.guests) { %> · <%= ev.guests %> pax<% } %>
                      <% if (ev.status) { %> · <%= ev.status %><% } %>
                    </li>
                  <% } else { %>
                    <!-- Function -->
                    <li class="ev fn">
                      <span class="i fn">Function</span>
                      <a href="/api/functions/<%= ev.id %>/edit">
                        <strong><%= ev.event_name %></strong>
                      </a>
                      <% if (ev.room) { %> — <%= ev.room %><% } %>
                      <% if (ev.attendees) { %> · <%= ev.attendees %> pax<% } %>
                      <% if (ev.contact_name || ev.contact_phone) { %>
                        <div class="muted">
                          <%= ev.contact_name || '' %><%= ev.contact_phone ? ' · ' + ev.contact_phone : '' %>
                        </div>
                      <% } %>
                    </li>
                  <% } %>
                <% }) %>
              </ul>
            <% } %>
          </td>
        <% }) %>
      </tr>
    </tbody>
  </table>
</div>

<%- include('../Partials/calendarModal') %>

